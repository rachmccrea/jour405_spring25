---
title: "final_project_mccrea"
author: "Rachel McCrea"
date: "2025-04-19"
output: html_document
---
Trying to run some tests! 

Feedback: 
- add GEOID to hospital_by_county using value from population data, join by GEOID 
- get rid of statewide rows in data. 

Loading in the data again (this is copied from the bottom of the notebook, which has notes on what I got help from AI on, and all the stuff we needed for one of the earlier project assignments): 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(tidycensus)
library(knitr)
```
```{r}
hospitals <- read_csv("md_hospitals_state_data.csv")
hospital_by_county <- read_csv("hospital_by_county.csv")
census_api_key("738bbf398565b3bd6d468669a0ef4374f13c150b", overwrite=TRUE)
population <- get_decennial(geography = "county", 
                            variable = "P1_001N", 
                            state = "MD",
                            year = 2020, 
                            sumfile = "pl")
income <- read_csv("md_pcpi_bea.csv")
```
Adding GEOID to hospital_by_county using population, going in thru excel and making those changes. 
Ended up putting in the GEOID numbers by hand, which introduces the risk of human error but led to me realizing that Queen Anne's County doesn't have a hospital. Looks like they have an emergency center run through UMD eastern shore, though. 

Loading updated hospital_by_county data

```{r}
hospital_by_county <- read_csv("hospital_by_county.csv")
```
Need to convert one of them from chr to dbl 

```{r}
glimpse(population)
#ah it's population. 

population <- population %>% 
  mutate(GEOID = as.numeric(GEOID))

glimpse(population)
#BAM i did that from MEMORY let's GO
```

Now I try to join them
```{r}
joined_hospital_population <- hospital_by_county %>% 
  right_join(population, join_by(GEOID==GEOID))
#YAY IT WORKED 
```
Only 22 counties/jurisdictions in MD have a hospital 
wait why the hell are there 25 jurisdictions in here wtf
ahhhh i see. i fucked it up and the counties don't match. Let me try to fix that. 
It's only garrett and washington that have the mismatch (population data for garrett repeated in the Washington row). Looks like I put in the Garrett GEOID instead of the Washington one. Gonna go back into excel, fix, load it again, and join again. 
```{r}
hospital_by_county <- read_csv("hospital_by_county.csv")

joined_hospital_population <- hospital_by_county %>% 
  right_join(population, join_by(GEOID==GEOID))

view(joined_hospital_population)
#WAHOO!! 

#Gonna write it as a .csv, load it in excel, change the column names, rearrange the columns, and read it back in. 
#deleted write_csv because it wrecked my changes on run-through. 
joined_hospital_population <- read_csv("joined_hospital_population.csv")
```
Ok, so now I know that 2 counties don't have hospitals, and I have the number of hospitals per county and county population in the same dataset. Yay!

Now I want to join number of hospitals with income. After that, I'll join all three. That'll leave me with 3 good datasets to work with: hospitals+population, hospitals+income, and hospitals+population+income. 


```{r}
#step 1: write income csv to folder, remove maryland row, add GEOID, and read it back in. 
#deleted write_csv() because when it ran it would delete the GEOIDs I added. 
income_per_capita <- read_csv("income.csv")

#step 2: join to hospital_by_county 

joined_hospital_income <- hospital_by_county %>% 
  right_join(income_per_capita, join_by("GEOID"=="GEOID"))
#consulted terpAI because this wasn't running, and then realized that when I did the run-all before turning this in I destroyed the version of income.csv that had the GEOIDs. went in, fixed it, got rid of the write_csv command. 

read_csv("joined_hospital_income.csv")
#had to go into excel and fix the dataset - mixed up baltimore city and county but it should be good to go now. 

#ok there we go. 
```


Now we join all three! 

```{r}
joined_all <- joined_hospital_population %>% 
  right_join(income_per_capita, join_by (GEOID==GEOID))

#cutting out the columns we don't need right now 

#joined_all_simplified <- joined_all %>% 
  #select(GEOID, number_of_hospitals, population, COUNTY, 2023_PCPI, RANK_PCPI_2023)
#^^this didn't work so I'm commenting it out. 

#aaaand i need to change some column names. going back to excel. 


joined_all <- read_csv("joined_all.csv")
#changed some column names in excel, deleted write_csv because it wrecked my changes on my last run-through. 

#let's try again. 

joined_all_simplified <- joined_all %>% 
  select(GEOID, number_of_hospitals, county_population, COUNTY, PCPI_2023, RANK_PCPI_2023)
#YAY
```

Ok now it's time to start running some tests. 
First step: linear regression with population and hospital numbers. I feel like that's a good thing to do right off the bat to get some scatterplots and p-values and residuals. 
I'm gonna do basically the same thing we did in class: copy in the ggplot code to make a scatterplot, then copy in the model code to run the regression. 

```{r}
joined_hospital_population |>
  ggplot(aes(x = county_population, y = number_of_hospitals)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  labs(x = "county population", y = "number of hospitals", title = "number of hospitals per county by population")
```
Looks like some counties with high populations have a high number of hospitals, but Baltimore City is an outlier with 15 hospitals. 
There's also a county with a relatively high population ond only a couple hospitals. Some with much lower populations have 3 instead of 2. 


```{r}
model <- lm(number_of_hospitals ~ county_population, data = joined_hospital_population)

summary(model)
```
Ok looking through this: 
P-value looks good (had to google what a statistically significant p-value was, forgot it was 0.05)
Adjusted R-squared is 0.42...does that mean it accounts for 42% or 0.42%? Had to google this too, looks like the closer it is to 1 the better. Sooooo it's looking like population Kinda But Not Totally affects the number of hospitals in a county so far. 
Min = -3
Max = 9 
Not liking those residuals. 
My interpretation: population explains some, but not all, of the number of hospitals in a county. 


Checking to see whether I get a different result if I switch the column order in the code: 

```{r}
model <- lm(county_population ~ number_of_hospitals, data = joined_hospital_population)

summary(model)
```
I think I probably made the right call with the other model. this one is a little confusing -- the big population numbers are hard and the p-value and adjusted r squared are the same. 


Now I'm gonna run the same thing for hospitals and income. 

```{r}
#changing column names in excel and reading it back in 
joined_hospital_income <- read_csv("joined_hospital_income.csv")

joined_hospital_income |>
  ggplot(aes(x = PCPI_2023, y = number_of_hospitals)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  labs(x = "per capita personal income", y = "number of hospitals", title = "number of hospitals per county by per capital personal income ")
```


That doesn't look like much of anything! Maybe a slight positive slope, but that's it. 

Running the linear regression model!

```{r}
model <- lm(number_of_hospitals ~ PCPI_2023, data = joined_hospital_income)

summary(model)

```
P-value is 0.8 and adjusted r^2 is -0.0437. Max residual is huge. Looks like I can disregard this. 

But I'm gonna try the same thing using rank_pcpi instead of pcpi_2023 to see how the richest and poorest counties compare. See if there's anything there. 


```{r}
joined_hospital_income |>
  ggplot(aes(x = RANK_PCPI_2023, y = number_of_hospitals)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  labs(x = "per capita personal income", y = "number of hospitals", title = "number of hospitals per county by per capital personal income ")
```


```{r}
model <- lm(number_of_hospitals ~ RANK_PCPI_2023, data = joined_hospital_income)

summary(model)

```

Once again, neither of these tests seems to point to a relationship between county wealth and number of hospitals. 

Once we learn multiple regressions next week, I might try to run that. 

TIME TO TRY ANOTHER THING. 

I'm interested in the distribution of hospitals, since it looks like the 2 counties without any are both on the Eastern Shore. I want to make a chloropleth map, but don't have geometry info for the counties or anything. I'll try something else. 

look at distribution of hospitals and distribution of population for eastern shore and western maryland -- does the ES have the same percentage of both population and hospitals? 

```{r}
joined_hospital_population <- joined_hospital_population %>% 
  mutate(shore = case_when(
    NAME  == "Caroline County, Maryland" ~ "shore",
    NAME == "Cecil County, Maryland" ~ "shore", 
    NAME == "Dorchester County, Maryland" ~ "shore", 
    NAME == "Kent County, Maryland" ~ "shore", 
    NAME == "Queen Anne's County, Maryland" ~ "shore", 
    NAME == "Somerset County, Maryland" ~ "shore", 
    NAME == "Talbot County, Maryland" ~ "shore", 
    NAME == "Wicomico County, Maryland" ~ "shore", 
    NAME == "Worcester County, Maryland" ~ "shore", 
    TRUE ~ "not_shore"
  ))
```

```{r}
#joined_hospital_population %>% 
  #group_by(shore) %>% 
  #summarize(hospitals = sum(number_of_hospitals))

#"shore" is coming up NA so I'm going to put "0" in for "NA" in excel for the two counties missing hospitals. is that allowed? also putting the county names in where they say "NA." 

joined_hospital_population <- read_csv("joined_hospital_population.csv")

#trying again 
joined_hospital_population%>% 
  group_by(shore) %>% 
  summarize(hospitals = sum(number_of_hospitals))
#shore has 11 hospitals, not_shore has 53. 
#population now 
joined_hospital_population%>% 
  group_by(shore) %>% 
  summarize(hospitals = sum(number_of_hospitals), population = (sum(county_population)))

shore <- joined_hospital_population %>% 
  mutate(number_of_hospitals = as.numeric(number_of_hospitals)) %>% 
  mutate(total_population = sum(county_population), total_hospitals = sum(number_of_hospitals)) %>% 
  mutate(pct_population = county_population/total_population, pct_hospitals = number_of_hospitals/total_hospitals) %>% 
  mutate(hospitals_per_1000 = number_of_hospitals/county_population * 1000)
#getting an error message. asking terp ai. 
#looks like i forgot to change "population" to "county_population" in the last line. 

  
glimpse(shore)

```
If I did this right, that means the shore has 7% of MD's population but 17% of its hospitals. Non-shore counties have ~92% of the population and 82% of hospitals. Looks like the shore has comparatively more hospitals than the rest of maryland, even though a couple counties don't have one.  



----------------------------------------------------------------------------------------------------


TESTS I COULD RUN: 

From my own brain: 
- Calculate the hospitals per 1000 rate
- Data visualization of hospitals per capitia, plus their locations (map). Not a test but still useful.
- Chi-square test - I think the data I have is applicable
- ANOVA test - I think the data I have is applicable 
- Would use both chi-square and ANOVA to test my hypothesis: that wealther counties have a higher hospital rate.

When I asked terp ai (conversation copy-pasted below), it told me to run the correlation coefficient (should've thought of that) and a linear regression. Both sounds good to me, so I'll probably use them too. 

Terp AI conversation: 

You  

Hey dude. I hope your day is going well. I'm working with R and the tidyverse to analyze some data: the number of hospitals per capita in Maryland counties and the median income of those counties. Any idea what kinds of tests I could run for this? I've already thought about chi-square and anova tests.
Logo
GPT 4o-mini - UMD3  

Hello! I'm glad to assist you with your data analysis in R and the tidyverse. Your project sounds interesting! Here are some statistical tests and methods you could consider for analyzing the relationship between the number of hospitals per capita and the median income of Maryland counties:

1. Correlation Analysis
Pearson Correlation Coefficient: This test measures the strength and direction of the linear relationship between two continuous variables (e.g., hospitals per capita and median income).
Spearman's Rank Correlation: If your data is not normally distributed, this non-parametric test can assess the relationship between the two variables.
2. Regression Analysis
Linear Regression: You can model the relationship between the number of hospitals per capita (dependent variable) and median income (independent variable). This will help you understand how changes in income relate to the number of hospitals.
Multiple Regression: If you have additional variables (e.g., population density, urban vs. rural classification), you could include them to see how they affect the relationship.
3. ANOVA (Analysis of Variance)
One-Way ANOVA: If you categorize the counties based on income brackets (e.g., low, medium, high), you can use ANOVA to test if there are significant differences in the number of hospitals per capita across these groups.
4. Chi-Square Test
This test is more suitable for categorical data. If you can categorize your counties based on the number of hospitals (e.g., low, medium, high) and median income, you can explore the association between these categories.
5. Non-parametric Tests
If your data does not meet the assumptions required for parametric tests (e.g., normality), you might want to consider non-parametric alternatives like the Kruskal-Wallis test for comparing more than two groups.
6. Visualization
Scatter Plots: Visualize the relationship between hospitals per capita and median income.
Box Plots: If using ANOVA, box plots can help visualize the distribution of hospitals per capita across different income categories.
Example Code in R
Here’s a simple example of how you might perform a linear regression in R:

R
# Load necessary libraries
library(tidyverse)

# Assuming your data frame is called 'data'
# with columns 'hospitals_per_capita' and 'median_income'

# Linear regression
model <- lm(hospitals_per_capita ~ median_income, data = data)
summary(model)

# Visualize the relationship
ggplot(data, aes(x = median_income, y = hospitals_per_capita)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Hospitals per Capita vs. Median Income",
       x = "Median Income",
       y = "Hospitals per Capita")
Conclusion
These tests will help you understand the relationship between hospitals per capita and median income. Make sure to check the assumptions of each test you choose to use. If you need further assistance or specific examples, feel free to ask!

You  

Thanks!
Logo
GPT 4o-mini - UMD3  

You're very welcome! If you have any more questions or need further assistance with your analysis, feel free to ask. Good luck with your project, and have a great day! 😊




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(tidycensus)
library(knitr)
```

Hospital data 
```{r}
hospitals <- read_csv("md_hospitals_state_data.csv")

hospitals %>% 
  group_by(County) %>% 
  summarize(count = n())
```
This CSV has a list of hospitals in MD with their name, county, address, and type. My goal with this data is to have each county be a column including the number of hospitals, county population, and per capita rate of hospitals. Would love some guidance on where to go from here with this this dataset -- I started by using group_by and summarize to figure out how many hospitals per county. Next, I think I'd try saving that as a new dataset and then joining it with population data. I'm gonna try that at the bottom of this notebook once I load population data. 

Population data

```{r}
census_api_key("github doesn't get my api key", overwrite=TRUE)
```
```{r}
population <- get_decennial(geography = "county", 
                            variable = "P1_001N", 
                            state = "MD",
                            year = 2020, 
                            sumfile = "pl")
#did a tidycensus lab a couple weeks ago in Ryan Little's data class. 
#used walker-data.com to figure out how to pull decennial census
#used chatgpt when i was having trouble finding the variable to pull total population per county. told it what i was trying to do, and that i couldn't find the variable. it gave me the variable and told me how to structure my code, specifiying the state and putting sumfile = pl. 
```
This dataset has census data listing the total population of each MD county. I plan to use it to calculate the hospital rate per capita, next step is to modify the hospital csv and join it with this and start doing some serious coding. 

Per capita personal income data 
```{r}
income <- read_csv("md_pcpi_bea.csv")
#did some editing in excel - changed the row names, got rid of the header, deleted data from other states, turned it into a csv. '
```
This is per capita personal income data by county from 2021, 2022, and 2023. The 2023 data is probably going to be the most relevant to my project. I expect to spend most of the time working with the 2023_PCPI column. I wish it also had a median income measure, I think that would protect against outliers messing with the data. 


Life expectancy data 
```{r}
life_expectancy <- read_csv("life_expectancy_md.csv")
```


This csv is just life expectancy by county, plus a row that has life expectancy for the whole state. This came from a much larger excel spreadsheet also saved to my project folder. 

TRYING TO JOIN HOSPITAL AND POPULATION DATA (need help)
```{r}
hospitals <- read_csv("md_hospitals_state_data.csv")

hospital_by_county <- hospitals %>% 
  group_by(County) %>% 
  summarize(count = n())

write_csv(hospital_by_county, file = "hospital_by_county.csv")
#learned how to do that ^ in data journalism this week 

#cleaned up county and row names in excel

hospital_by_county <- read_csv("hospital_by_county.csv")

joined_hospital_population <- hospital_by_county %>% 
  right_join(population, join_by(county==NAME))
#learned how to join in data class. None of the joins I tried preserved both the number of hospitals and the population -- it was either one or the other and I'm stuck. 
```


